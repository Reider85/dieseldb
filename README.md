DieselDBServer - Простая многопоточная файловая база данных
DieselDBServer представляет собой сервер базы данных, написанный на Java, который поддерживает базовые операции CRUD (Create, Read, Update, Delete) с сохранением данных в файлы и многопоточным чтением/записью. Сервер работает по сетевому протоколу TCP и обрабатывает команды от клиентов в многопоточном режиме.

Основные особенности:
Сетевой сервер:
Слушает подключения на порту 9090.
Обрабатывает подключения клиентов в отдельных потоках с использованием пула потоков (ExecutorService).
Хранение данных:
Данные хранятся в памяти в структуре ConcurrentHashMap<String, List<Map<String, String>>>, где ключ - имя таблицы, а значение - список строк (каждая строка - это Map с парами ключ-значение).
Для обеспечения потокобезопасности используется CopyOnWriteArrayList для списков строк.
Поддерживаемые команды:
PING - проверка связи (возвращает "PONG").
CREATE§§§<tableName> - создание новой таблицы.
INSERT§§§<tableName>§§§key1:::value1:::key2:::value2 - вставка строки в таблицу.
SELECT§§§<tableName>§§§key=value - выбор строк по условию (или всех строк, если условие отсутствует).
UPDATE§§§<tableName>§§§condition;;;key1:::value1 - обновление строк по условию.
DELETE§§§<tableName>§§§key=value - удаление строк по условию (или всей таблицы, если условие не указано).
Сохранение и загрузка данных:
Данные сохраняются в файлы в директории dieseldb_data с расширением .ddb.
При запуске сервера все существующие таблицы загружаются из файлов многопоточно с использованием пула потоков, размер которого зависит от количества доступных процессоров.
После каждой операции модификации (CREATE, INSERT, UPDATE, DELETE) изменённая таблица асинхронно сохраняется в файл.
При завершении работы сервера все таблицы сохраняются в файлы также в многопоточном режиме.
Многопоточность:
Используется ExecutorService с кэшированным пулом потоков для обработки клиентских запросов.
Загрузка таблиц при старте и сохранение при завершении работы выполняются параллельно с использованием пула потоков фиксированного размера.
Структура работы:
Запуск: Сервер создаёт директорию для данных, загружает существующие таблицы из файлов и начинает слушать подключения.
Обработка запросов: Каждый клиент обрабатывается в отдельном потоке. Команды парсятся и выполняются с немедленным сохранением изменений в файл (асинхронно).
Завершение: При получении сигнала завершения (Ctrl+C или программный shutdown) все таблицы сохраняются в файлы, а пул потоков закрывается.
Формат хранения:
Каждая таблица сохраняется в отдельный файл <tableName>.ddb с использованием сериализации Java (ObjectOutputStream/ObjectInputStream).
Формат данных в файле соответствует внутренней структуре таблицы (список словарей).
Пример использования:
text

Свернуть

Перенос

Копировать
PING ? OK: PONG
CREATE§§§users ? OK: Table 'users' created
INSERT§§§users§§§name:::John:::age:::30 ? OK: 1 row inserted
SELECT§§§users§§§age=30 ? OK: name:::age;;;John:::30
UPDATE§§§users§§§name=John;;;age:::31 ? OK: 1
DELETE§§§users§§§age=31 ? OK: 1
Ограничения и возможные улучшения:
Используется простая сериализация Java, что может быть заменено на JSON или бинарный формат для большей гибкости.
Отсутствует журналирование операций (write-ahead logging) для восстановления после сбоев.
Нет сжатия данных или версионирования.
Условия в SELECT/UPDATE/DELETE поддерживают только простое равенство (key=value).
Этот код представляет собой базовую реализацию файловой базы данных с многопоточностью и может служить основой для более сложных систем.

